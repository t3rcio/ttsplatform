{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title>TTS</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            let interval = 0;
            $(document).ready(function(){
                {% if ide %}
                function verifica_progresso(){
                    let url = "{% url 'monitoring' ide %}?query=progress";
                    let req = new XMLHttpRequest();
                    req.onload = function(){
                        let data = JSON.parse(this.responseText);
                        if (data.progress){                            
                            $("#loadingModal").modal('show');
                            $("#progressbar").css("width", data.progress);
                        }
                        if (data.loadaudio){
                            setTimeout(window.location = '{{APP_URL}}/ide/' + data.loadaudio, 1000);
                        }
                    }
                    req.open("GET", url);
                    req.onerror = (err) =>{
                        console.log(err);
                    }
                    req.send();	
                }
                interval = window.setInterval(verifica_progresso, 2000);
                {% else %}
                clearInterval(interval);
                {% endif %}
            });
            function submete(){
                $("#loadingModal").modal('show');
                $("#form").submit();
            }
        </script>
    </head>
    <body class="bg-dark" style="padding:70px;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 text-white">
                    <h1>
                        Conversor de texto
                    </h1>
                    <div class="card">
                        <div class="card-body tex-center">
                            <form id="form" action="{% url 'home' %}" method="POST">
                                {% csrf_token %}
                                <div class="form-group">                          
                                  <input type="url" placeholder="Cole a url aqui" name="url" class="form-control" id="url">
                                </div>
                                <hr/>
                                <button type="button" onclick="submete()" class="btn btn-lg btn-primary">Converter</button>
                            </form>
                        </div>
                    </div> 
                </div>
            </div>
        </div>
        <div id="loadingModal" class="modal" role="dialog">
            <div class="modal-dialog">          
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title">Carregando</h4>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div id="progressbar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width:0%;"></div>
                    </div>
                </div>
              </div>          
            </div>
        </div>
    </body>
</html> 